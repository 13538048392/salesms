<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Login</title>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css">
    <script src="https://cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>
    <script src="/static/js/login.js"></script>
</head>
<body>
    {include file="../application/index/view/public/_header.html"}
<div class="container" style="margin: 60px 0 0 0;">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <h2>{$Think.lang.reset_pass}</h2>
            <form role="form" onsubmit="return false;">
                <input type="hidden" name="__token__" value="{$Request.token}"/>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        <label for="username"></label>
                        <input type="text" placeholder="" class="form-control" id="username" name="username" value="<?php echo isset($_GET['username'])?$_GET['username']:''?>" readonly="">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        <label for="email"></label>
                        <input type="text" placeholder="" class="form-control" id="email" name="email" value="<?php echo isset($_GET['email'])?$_GET['email']:''?>" readonly="">
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 form-group">
                        <label for="password"></label>
                        <input type="password" placeholder="{$Think.lang.reset_pass}：" class="form-control" id="password" name="password">
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 form-group">
                        <label for="password2"></label>
                        <input type="password" placeholder="{$Think.lang.reset_pass2}：" class="form-control" id="password2" name="password2">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6 form-group">
                        <!-- <a  href="#" role="button">Forgot Password</a> -->
                        
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        <button type="submit" class="btn btn-lg btn-success btn-block" id="commit">{$Think.lang.commit}</button>
                    </div>
                </div>
            </form>
            <div id="success_message" style="width:100%; height:100%;"></div>
            </div>
        </div>
    </div>
</div>
<script>
pass_check = "{$Think.lang.pass_not_null}";
pass2_check = "{$Think.lang.pass2_not_null}";
$(function () {
    $('form').bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            password: {
                message: '',
                validators: {
                    notEmpty: {
                        message: pass_check
                    }
                }
            },
            password2: {
                message: '',
                validators: {
                    notEmpty: {
                        message: pass2_check
                    }
                }
            },
                    }
    }).on('success.form.bv', function (e) {
        // Prevent form submission
        // e.preventDefault();
        // // Get the form instance
        // var $form = $(e.target);
        // // Get the BootstrapValidator instance
        // var bv = $form.data('bootstrapValidator');
        // // Use Ajax to submit form data
        // $.post($form.attr('action'), $form.serialize(), function (result) {
        //     console.log(result);
        // }, 'json');
    });
    
});


$('#commit').click(function(){
    //提交验证码
    var username = $('#username').val();
    var email = $('#email').val();
    var password = $('#password').val();
    var password2 = $('#password2').val();
    $('#commit').attr('disabled',true);
    $.ajax({
            url:'doResetPass',
            type:'post',
            data:{'username':username,'email':email,'password':password,'password2':password2},
            success:function(msg){
                if (msg.status == 200) {
                    $('#success_message').html('<h3>'+msg.msg+'</h3>');
                    window.setTimeout("window.location='{:url('/login')}'",2000); 
                }else{
                    $('#success_message').html('<h3>'+msg.msg+'</h3>');
                    $('#commit').attr('disabled',false);
                }
            }
        });

});
        
        
</script>
</body>
</html>